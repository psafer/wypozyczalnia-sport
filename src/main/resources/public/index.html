<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Wypożyczalnia Sprzętu Sportowego</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body class="bg-light d-flex flex-column min-vh-100">
    <!-- HEADER -->
    <div id="header"></div>

    <!-- MAIN -->
    <main class="flex-grow-1">
      <div class="container pt-4">
        <!-- Tytuł -->
        <div class="text-center mb-4">
          <h1>Wypożyczalnia Sprzętu Sportowego</h1>
          <p class="lead text-muted">
            Zarządzaj sprzętem, rezerwacjami i dostępnością
          </p>
        </div>

        <!-- KAFELKI NAWIGACYJNE -->
        <div class="row g-4 mb-5">
          <div class="col-md-6">
            <a
              href="sprzet.html"
              class="btn btn-outline-primary w-100 py-3 fs-5 d-flex justify-content-center align-items-center gap-2">
              <i class="bi bi-box-seam"></i>
              Lista sprzętu
            </a>
          </div>

          <div class="col-md-6">
            <a
              href="add-sprzet.html"
              class="btn btn-outline-success w-100 py-3 fs-5 d-flex justify-content-center align-items-center gap-2">
              <i class="bi bi-plus-circle"></i>
              Dodaj sprzęt
            </a>
          </div>

          <div class="col-md-6">
            <a
              href="rezerwacje.html"
              class="btn btn-outline-primary w-100 py-3 fs-5 d-flex justify-content-center align-items-center gap-2">
              <i class="bi bi-calendar-check"></i>
              Rezerwacje
            </a>
          </div>

          <div class="col-md-6">
            <a
              href="add-rezerwacja.html"
              class="btn btn-outline-success w-100 py-3 fs-5 d-flex justify-content-center align-items-center gap-2">
              <i class="bi bi-calendar-plus"></i>
              Dodaj rezerwację
            </a>
          </div>
        </div>

        <!-- DASHBOARD -->
        <hr class="my-5" />

        <!-- KAFELKI STATYSTYK -->
        <div class="row g-4 mb-4">
          <div class="col-md-3">
            <div class="card shadow-sm text-center">
              <div class="card-body">
                <i class="bi bi-box-seam fs-2 text-primary"></i>
                <h6 class="mt-2">Rodzaje sprzętu</h6>
                <p class="fs-4 fw-bold mb-0" id="stat-equipment">–</p>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card shadow-sm text-center">
              <div class="card-body">
                <i class="bi bi-x-circle fs-2 text-danger"></i>
                <h6 class="mt-2">Brak na stanie</h6>
                <p class="fs-4 fw-bold mb-0" id="stat-unavailable">–</p>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card shadow-sm text-center">
              <div class="card-body">
                <i class="bi bi-people fs-2 text-primary"></i>
                <h6 class="mt-2">Klienci</h6>
                <p class="fs-4 fw-bold mb-0" id="stat-clients">–</p>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card shadow-sm text-center">
              <div class="card-body">
                <i class="bi bi-calendar-check fs-2 text-warning"></i>
                <h6 class="mt-2">Aktywne rezerwacje</h6>
                <p class="fs-4 fw-bold mb-0" id="stat-active">–</p>
              </div>
            </div>
          </div>
        </div>

        <!-- WYKRES -->
        <div class="row">
          <div class="col-md-4 mx-auto">
            <div class="card shadow-sm">
              <div class="card-body p-3">
                <h6 class="text-center mb-2">Dostępność sprzętu</h6>
                <canvas id="equipmentChart" height="90"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <div id="footer"></div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- HEADER + FOOTER -->
    <script>
      fetch("header.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("header").innerHTML = html;

          const current = window.location.pathname.split("/").pop();
          document.querySelectorAll(".nav-link").forEach((link) => {
            if (link.getAttribute("href") === current) {
              link.classList.add("active");
            }
          });
        });

      fetch("footer.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("footer").innerHTML = html;
        });
    </script>

    <!-- DASHBOARD LOGIKA -->
    <script>
      function loadDashboardStats() {
        fetch("/sprzet")
          .then((res) => res.json())
          .then((data) => {
            const total = data.length;
            const unavailable = data.filter((eq) => eq.quantity === 0).length;
            const available = total - unavailable;

            document.getElementById("stat-equipment").textContent = total;
            document.getElementById("stat-unavailable").textContent =
              unavailable;

            new Chart(document.getElementById("equipmentChart"), {
              type: "doughnut",
              data: {
                labels: ["Dostępne", "Brak na stanie"],
                datasets: [
                  {
                    data: [available, unavailable],
                    backgroundColor: ["#198754", "#dc3545"],
                  },
                ],
              },
              options: {
                plugins: {
                  legend: {
                    display: false,
                  },
                },
                cutout: "70%",
              },
            });
          });

        fetch("/klienci")
          .then((res) => res.json())
          .then((data) => {
            document.getElementById("stat-clients").textContent = data.length;
          });

        fetch("/rezerwacje")
          .then((res) => res.json())
          .then((data) => {
            document.getElementById("stat-active").textContent = data.filter(
              (r) => r.status === "ACTIVE",
            ).length;
          });
      }

      loadDashboardStats();
    </script>
  </body>
</html>
